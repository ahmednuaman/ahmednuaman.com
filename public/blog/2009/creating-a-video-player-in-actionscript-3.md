title: Creating a Video Player in Actionscript 3
link: http://www.ahmednuaman.com/blog/creating-a-video-player-in-actionscript-3/
creator: ahmed
description: 
post_id: 193
post_date: 2009-06-22 13:54:06
post_date_gmt: 2009-06-22 13:54:06
comment_status: open
post_name: creating-a-video-player-in-actionscript-3
status: publish
post_type: post

# Creating a Video Player in Actionscript 3

So I've been working on creating a fully fledged player for the web site [1Click2Fame.com](http://1Click2Fame.com). A lot of people who have been following me on twitter have been asking me to publish my code, so here's what you've all been waiting for. This isn't just your average FLV video player. I'm not going to go into great depths on creating stuff like the stop button, the seek bar and what not, I believe in creating clean and reusable code, so this tutorial is more about creating a great chromeless player API and then allowing you to go crazy with the UI. So let's begin! Start by firing up your favourite Actionscript 3 IDE and create a new project. All my classes belong in the package **com.firestartermedia.as3** so subsequently, my chromeless player is part of my **com.firestartermedia.as3.display.component**, a lot maybe, but I do a lot of Actionscript 3 coding. Let's start with what we want to achieve from our chromeless player: 

  * We want it to play FLVs, obviously
  * We want to be able to start, pause and resume it
  * We want it to inform us of cue points and give us the ability to add our own cue points
  * We want to be able to resize it without affecting it's aspect ratio
  * We want to be able to get it's current loading and playing states
A lot maybe, but it's all very achievable. Ready for the code? Here it is: **VideoPlayerChromeless.as:** ` package com.firestartermedia.lib.as3.display.component { import com.firestartermedia.lib.as3.events.VideoPlayerEvent; import com.firestartermedia.lib.as3.utils.ArrayUtil; import com.firestartermedia.lib.as3.utils.NumberUtil; import flash.display.Sprite; import flash.events.Event; import flash.events.NetStatusEvent; import flash.media.Video; import flash.net.NetConnection; import flash.net.NetStream; import flash.utils.setTimeout; public class VideoPlayerChromless extends Sprite { public var bufferTime:Number = 2; private var cuePoints:Array = [ ]; private var lastFiredCuePoint:Number = 0; private var metaData:Object = { }; private var video:Video = new Video(); private var isLoading:Boolean; private var isOverHalfWay:Boolean; private var isPlaying:Boolean; private var rawHeight:Number; private var rawWidth:Number; private var stream:NetStream; private var videoHeight:Number; private var videoWidth:Number; public function VideoPlayerChromless() { var connection:NetConnection = new NetConnection(); connection.addEventListener( NetStatusEvent.NET_STATUS, handleNetStatus ); connection.connect( null ); stream = new NetStream( connection ); stream.bufferTime = 5; stream.client = { onMetaData: handleOnMetaData }; stream.addEventListener( NetStatusEvent.NET_STATUS, handleNetStatus ); video.smoothing = true; video.attachNetStream( stream ); addChild( video ); } public function play(url:String):void { stream.bufferTime = bufferTime; stream.close(); stream.play( url ); isLoading = true; isOverHalfWay = false; isPlaying = false; addEventListener( Event.ENTER_FRAME, handleEnterFrame ); } private function handleEnterFrame(e:Event):void { if ( isLoading ) { checkLoadingStatus(); } if ( cuePoints.length > 0 ) { checkForCuePoints(); } } private function checkLoadingStatus():void { var progress:Object = loadingProgress; if ( progress.total === 1 ) { isLoading = false; dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.LOADED ) ); } else { dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.LOADING, progress ) ); } } private function checkForCuePoints():void { var time:Number = playingTime.current; var checkTime:Number = Math.floor( time ); var test:Number = ArrayUtil.search( cuePoints, checkTime ); var cuePoint:Number; if ( test > -1 ) { cuePoint = cuePoints[ test ]; if ( cuePoint > lastFiredCuePoint ) { dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.CUE_POINT, { point: cuePoint, halfway: false, finished: false } ) ); lastFiredCuePoint = cuePoint; } } if ( !isOverHalfWay && ( time / 2 ) > playingTime.total ) { isOverHalfWay = true; dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.HALF_WAY, { point: checkTime, halfway: true, finished: false } ) ); } } public function addCuePoint(seconds:Number):void { cuePoints.push( seconds ); } public function pause():void { stream.pause(); isPlaying = false; dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.PAUSED ) ); } public function resume():void { stream.resume(); isPlaying = true; dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.PLAYING ) ); } private function handleNetStatus(e:NetStatusEvent):void { var code:String = e.info.code; trace(code); switch ( code ) { case 'NetStream.Play.Start': dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.BUFFERING ) ); break; case 'NetStream.Buffer.Full': dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.STARTED ) ); resume(); break; case 'NetStream.Play.Stop': dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.ENDED, { point: playingTime.total, halfway: false, finished: true } ) ); break; case 'NetStream.Seek.InvalidTime': //dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.BUFFERING ) ); break; case 'NetStream.Seek.Notify': dispatchEvent( new VideoPlayerEvent( VideoPlayerEvent.BUFFERING ) ); break; } } private function handleOnMetaData(info:Object):void { metaData = info; } public function resize(width:Number=0, height:Number=0):void { rawHeight = height; rawWidth = width; if ( !metaData.hasOwnProperty( 'height') && !metaData.hasOwnProperty( 'width' ) ) { setTimeout( doResize, 250, width, height ); } else { doResize( width, height ); } } private function doResize(width:Number, height:Number):void { var targetHeight:Number = ( height > 0 ? height : videoHeight ); var targetWidth:Number = targetHeight * ( metaData.width / metaData.height ); if ( targetWidth > width ) { targetWidth = ( width > 0 ? width : videoWidth ); targetHeight = targetWidth * ( metaData.height / metaData.width ); } videoHeight = targetHeight; videoWidth = targetWidth; video.height = targetHeight; video.width = targetWidth; video.x = ( width / 2 ) - ( targetWidth / 2 ); video.y = ( height / 2 ) - ( targetHeight / 2 ); } public function get loadingProgress():Object { var progress:Object = { }; progress.total = stream.bytesLoaded / stream.bytesTotal; progress.bytesLoaded = stream.bytesLoaded; progress.bytesTotal = stream.bytesTotal; return progress; } public function get playingTime():Object { var time:Object = { }; time.current = stream.time; time.total = metaData.duration; time.formatted = NumberUtil.toTimeString( Math.round( stream.time ) ) + ' / ' + NumberUtil.toTimeString( Math.round( metaData.duration ) ); return time; } } } ` **VideoPlayerEvent.as:** ` package com.firestartermedia.lib.as3.events { import flash.events.Event; public class VideoPlayerEvent extends Event { public static const NAME:String = 'VideoPlayerEvent'; public static const BUFFERING:String = NAME + 'Buffering'; public static const LOADING:String = NAME + 'Loading'; public static const LOADED:String = NAME + 'Loaded'; public static const STARTED:String = NAME + 'Started'; public static const PLAYING:String = NAME + 'Playing'; public static const PAUSED:String = NAME + 'Paused'; public static const CUE_POINT:String = NAME + 'CuePoint';

## Comments

**[Flv Player](#109 "2009-07-01 10:24:49"):** I bookmarked this page. Thank you for given this useful post...

**[Steven](#333 "2010-05-13 17:04:41"):** I understand that this Actionscript 3 here can be used with Flash CS3. I can set the class name in Flash property pannel, in this case: com.firestartermedia.lib.as3.display.component and export the .swf file to get the YouTube player. What is not clear for me is, where do I find the classes you are using for this project? You only say that all your classes are in this folder package com.firestartermedia.as3, but there is no link provided. import com.firestartermedia.lib.as3.events.VideoPlayerEvent; import com.firestartermedia.lib.as3.utils.ArrayUtil; import com.firestartermedia.lib.as3.utils.NumberUtil;

**[Tayyab](#309 "2010-03-31 00:58:44"):** How to use it?

**[Ahmed](#318 "2010-04-28 08:43:10"):** How do you mean? How do you use the chromeless player?

**[Steven](#334 "2010-05-13 17:19:56"):** sorry, to set the class name in Flash property pannel to: VideoPlayerChromless, but then again, how do I call the VideoPlayerEvent.as? will you be able to explane the use with FlashCS3?

**[Ahmed](#335 "2010-05-14 07:47:20"):** Hey Steven. My apologise for not explaining it very well. What I'll do is create a new blog post to say how to use it. Regarding VideoPlayerEvent.as, that's at com.firestartermedia.lib.as3.events Sorry about the huge lack of docs, a lot of this code was written in a production 'JFDI' environment so documentation wasn't very important. But I *will* find time do to it :D

